<!DOCTYPE html>
<html>
<head>
    <title>ğŸŒŸ ì¸ê³µì§€ëŠ¥ ì˜ˆì¸¡ ë†€ì´ ğŸŒŸ</title>
    <style>
        /* ì˜ˆì˜ê²Œ ë³´ì´ë„ë¡ ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•´ìš”! */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            text-align: center;
            padding: 20px;
            color: #333;
        }

        h1 {
            color: #ff6347; /* ë°ì€ ì£¼í™©ìƒ‰ ì œëª© */
            margin-bottom: 30px;
            font-size: 2.5em; /* ì œëª©ì„ í¬ê²Œ */
        }

        #main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #webcam-area {
            background-color: #ffffff; /* í•˜ì–€ìƒ‰ ë°°ê²½ */
            border: 5px solid #4682b4; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
            border-radius: 15px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
        }

        #label-area {
            background-color: #fffacd; /* ë ˆëª¬ìƒ‰ ë°°ê²½ */
            border: 3px solid #daa520; /* í™©ê¸ˆìƒ‰ í…Œë‘ë¦¬ */
            border-radius: 10px;
            padding: 15px;
            width: 80%;
            max-width: 400px;
            font-size: 1.2em; /* ê¸€ì í¬ê¸° í‚¤ìš°ê¸° */
            text-align: left;
        }

        .prediction-label {
            margin: 5px 0;
            padding: 8px;
            border-bottom: 1px dashed #ccc;
            font-weight: bold;
        }

        #loading-message {
            color: #4682b4;
            font-size: 1.5em;
            font-weight: bold;
        }
    </style>
</head>
<body onload="init()">
    <h1>ğŸŒŸ ì¸ê³µì§€ëŠ¥ ì¹œêµ¬ì˜ ì˜ˆì¸¡ ë†€ì´! ğŸŒŸ</h1>
    <p>ğŸ‘€ ì¹´ë©”ë¼ ì•ì— ë¬¼ê±´ì„ ë³´ì—¬ì£¼ì„¸ìš”! ì¸ê³µì§€ëŠ¥ì´ ë¬´ì—‡ì¸ì§€ ë§í ê±°ì˜ˆìš”!</p>

    <div id="main-container">
        <div id="webcam-area">
            <div id="webcam-container"></div>
            <div id="loading-message">ğŸš€ ì¤€ë¹„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”! ğŸš€</div>
        </div>

        <h2>âœ¨ ì¸ê³µì§€ëŠ¥ì˜ ìƒê° âœ¨</h2>
        <div id="label-area">
            <div id="label-container"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        // ëª¨ë¸ íŒŒì¼ì˜ ì£¼ì†Œë¥¼ ì•Œë ¤ì¤˜ìš”
        const URL = "./my_model/"; // ê¼­ './my_model/' í´ë”ê°€ ê°™ì€ ê³³ì— ìˆì–´ì•¼ í•´ìš”!

        let model, webcam, labelContainer, maxPredictions;

        // ğŸ§  ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ê³  ì¹´ë©”ë¼ë¥¼ ì¼œëŠ” í•¨ìˆ˜
        async function init() {
            // "ì¤€ë¹„ ì¤‘" ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤˜ìš”
            document.getElementById("loading-message").style.display = 'block';

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // ëª¨ë¸ì„ ë¶ˆëŸ¬ì™€ìš”!
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // ì¹´ë©”ë¼ë¥¼ ì¼œìš”!
            const flip = true; // ì¢Œìš°ë¥¼ ë°”ê¿€ê¹Œìš”? ë„¤!
            webcam = new tmImage.Webcam(200, 200, flip); // í¬ê¸°: 200x200
            await webcam.setup(); // ì¹´ë©”ë¼ ê¶Œí•œì„ ìš”ì²­í•´ìš”
            await webcam.play();

            // "ì¤€ë¹„ ì¤‘" ë©”ì‹œì§€ë¥¼ ìˆ¨ê²¨ìš”
            document.getElementById("loading-message").style.display = 'none';

            // í™”ë©´ì— ì¹´ë©”ë¼ ì˜ìƒì„ ë³´ì—¬ì¤˜ìš”
            document.getElementById("webcam-container").appendChild(webcam.canvas);

            // ì˜ˆì¸¡ ê²°ê³¼ê°€ ë‚˜ì˜¬ ê³³ì„ ì¤€ë¹„í•´ìš”
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                const predictionDiv = document.createElement("div");
                predictionDiv.classList.add("prediction-label"); // CSS ìŠ¤íƒ€ì¼ì„ ì ìš©í•´ìš”
                labelContainer.appendChild(predictionDiv);
            }

            // ì´ì œ ê³„ì†í•´ì„œ ì˜ˆì¸¡ì„ ì‹œì‘í•´ìš”!
            window.requestAnimationFrame(loop);
        }

        // ğŸ”„ ê³„ì† ë°˜ë³µí•˜ë©° ì¹´ë©”ë¼ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì˜ˆì¸¡í•˜ëŠ” í•¨ìˆ˜
        function loop() {
            webcam.update(); // ì¹´ë©”ë¼ í™”ë©´ì„ ìƒˆë¡­ê²Œ ì°ì–´ìš”
            predict(); // ì˜ˆì¸¡ì„ í•´ë´ìš”
            window.requestAnimationFrame(loop); // ë‹¤ìŒì—ë„ ë˜ í•´ì¤˜!
        }

        // ğŸ§ ì¸ê³µì§€ëŠ¥ì´ ì˜ˆì¸¡í•˜ê²Œ í•˜ëŠ” í•¨ìˆ˜
        async function predict() {
            // ì¹´ë©”ë¼ í™”ë©´ì„ ì¸ê³µì§€ëŠ¥ì—ê²Œ ë³´ì—¬ì£¼ê³  ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ë°›ì•„ìš”
            const prediction = await model.predict(webcam.canvas);

            // ê²°ê³¼ë¥¼ í•˜ë‚˜ì”© ë³´ì—¬ì¤˜ìš”
            for (let i = 0; i < maxPredictions; i++) {
                // ì˜ˆì¸¡ ì´ë¦„ê³¼ ëª‡ % ë¯¿ëŠ”ì§€ ìˆ«ìë¥¼ ë³´ì—¬ì¤˜ìš” (ì†Œìˆ˜ì  ë‘ ìë¦¬ê¹Œì§€)
                const percent = (prediction[i].probability * 100).toFixed(0); // ë°±ë¶„ìœ¨ë¡œ ë§Œë“¤ê³  ì†Œìˆ˜ì ì„ ì—†ì• ìš”
                let emoji = "ğŸ¤”"; // ê¸°ë³¸ ì´ëª¨ì§€

                if (prediction[i].probability > 0.80) {
                    emoji = "ğŸ¯"; // 80% ì´ìƒ: ì•„ì£¼ í™•ì‹¤í•´!
                } else if (prediction[i].probability > 0.50) {
                    emoji = "ğŸ’¡"; // 50% ì´ìƒ: ì•„ë§ˆë„ ì´ê±°ì•¼!
                }

                const classPrediction = `${emoji} **${prediction[i].className}**: ${percent}%`;

                // ê²°ê³¼ë¥¼ í™”ë©´ì— ë³´ì—¬ì¤˜ìš”
                labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }
    </script>
</body>
</html>
