<!DOCTYPE html>
<html>
<head>
    <title>ğŸŒŸ ì¸ê³µì§€ëŠ¥ ì˜ˆì¸¡ ë†€ì´ ğŸŒŸ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ğŸ¨ ë””ìì¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            text-align: center;
            padding: 20px;
            color: #333;
            margin: 0;
        }

        h1 {
            color: #ff6347; /* ë°ì€ ì£¼í™©ìƒ‰ ì œëª© */
            margin-bottom: 15px;
            font-size: 2.5em; 
        }

        p {
            font-size: 1.1em;
            margin-bottom: 30px;
        }

        #main-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
        }

        #webcam-area {
            background-color: #ffffff; 
            border: 6px solid #4682b4; /* íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
            border-radius: 20px; 
            padding: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
            min-height: 220px; /* ë¡œë”© ë©”ì‹œì§€ ê³µê°„ í™•ë³´ */
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #webcam-container canvas {
            border-radius: 10px;
        }

        #label-area {
            background-color: #fffacd; /* ë ˆëª¬ìƒ‰ ë°°ê²½ */
            border: 4px solid #daa520; /* í™©ê¸ˆìƒ‰ í…Œë‘ë¦¬ */
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 450px;
            font-size: 1.2em; 
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .prediction-label {
            margin: 10px 0;
            padding: 8px;
            border-bottom: 1px dashed #ccc;
            font-weight: bold;
        }
        
        .prediction-label:last-child {
            border-bottom: none; /* ë§ˆì§€ë§‰ ì¤„ì—ëŠ” ì ì„  ì—†ì• ê¸° */
        }

        #loading-message {
            color: #4682b4;
            font-size: 1.6em;
            font-weight: bold;
            padding: 20px;
        }
    </style>
</head>

<body onload="init()">
    <h1>ğŸŒŸ ì¸ê³µì§€ëŠ¥ ì¹œêµ¬ì˜ ì˜ˆì¸¡ ë†€ì´! ğŸŒŸ</h1>
    <p>ğŸ‘€ ì¹´ë©”ë¼ ì•ì— ë¬¼ê±´ì„ ë³´ì—¬ì£¼ì„¸ìš”! ì¸ê³µì§€ëŠ¥ì´ ë¬´ì—‡ì¸ì§€ ë§í ê±°ì˜ˆìš”!</p>

    <div id="main-container">
        <div id="webcam-area">
            <div id="webcam-container"></div>
            <div id="loading-message">ğŸš€ ì¤€ë¹„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”! ğŸš€</div>
        </div>

        <h2>âœ¨ ì¸ê³µì§€ëŠ¥ì˜ ìƒê° âœ¨</h2>
        <div id="label-area">
            <div id="label-container"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script type="text/javascript">
        // ëª¨ë¸ íŒŒì¼ì˜ ì£¼ì†Œë¥¼ ì•Œë ¤ì¤˜ìš”. (HTML íŒŒì¼ê³¼ ê°™ì€ ìœ„ì¹˜ì— 'my_model' í´ë”ê°€ ìˆì–´ì•¼ í•´ìš”!)
        const URL = "./my_model/";

        let model, webcam, labelContainer, maxPredictions;

        // ğŸ§  ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ê³  ì¹´ë©”ë¼ë¥¼ ì¼œëŠ” í•¨ìˆ˜
        async function init() {
            // "ì¤€ë¹„ ì¤‘" ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì¤˜ìš”
            document.getElementById("loading-message").style.display = 'block';

            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            // ëª¨ë¸ì„ ë¶ˆëŸ¬ì™€ìš”! (ì¸í„°ë„· ì†ë„ì— ë”°ë¼ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆì–´ìš”)
            try {
                model = await tmImage.load(modelURL, metadataURL);
            } catch (e) {
                document.getElementById("loading-message").innerHTML = "âŒ ëª¨ë¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”. 'my_model' í´ë”ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”!";
                console.error("Model loading failed:", e);
                return; // ëª¨ë¸ ë¡œë”© ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ì„œ ë©ˆì¶¤
            }
            
            maxPredictions = model.getTotalClasses();

            // ì¹´ë©”ë¼ë¥¼ ì¼œìš”!
            const flip = true; // ì¢Œìš° ë°˜ì „
            webcam = new tmImage.Webcam(200, 200, flip); 
            
            try {
                await webcam.setup(); // ì¹´ë©”ë¼ ê¶Œí•œ ìš”ì²­ ë° ì„¤ì •
                await webcam.play();
            } catch (e) {
                document.getElementById("loading-message").innerHTML = "ğŸš¨ ì¹´ë©”ë¼ë¥¼ ì¼¤ ìˆ˜ ì—†ì–´ìš”! ë¸Œë¼ìš°ì €ì—ì„œ **ì¹´ë©”ë¼ ì‚¬ìš©ì„ í—ˆë½**í•´ì£¼ì„¸ìš”.";
                console.error("Webcam setup failed:", e);
                return; // ì¹´ë©”ë¼ ì„¤ì • ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ì„œ ë©ˆì¶¤
            }

            // ì´ì œ "ì¤€ë¹„ ì¤‘" ë©”ì‹œì§€ë¥¼ ìˆ¨ê²¨ìš”
            document.getElementById("loading-message").style.display = 'none';

            // í™”ë©´ì— ì¹´ë©”ë¼ ì˜ìƒì„ ë³´ì—¬ì¤˜ìš”
            document.getElementById("webcam-container").appendChild(webcam.canvas);

            // ì˜ˆì¸¡ ê²°ê³¼ê°€ ë‚˜ì˜¬ ê³³ì„ ì¤€ë¹„í•´ìš”
            labelContainer = document.getElementById("label-container");
            for (let i = 0; i < maxPredictions; i++) {
                const predictionDiv = document.createElement("div");
                predictionDiv.classList.add("prediction-label");
                labelContainer.appendChild(predictionDiv);
            }

            // ì´ì œ ê³„ì†í•´ì„œ ì˜ˆì¸¡ì„ ì‹œì‘í•´ìš”!
            window.requestAnimationFrame(loop);
        }

        // ğŸ”„ ê³„ì† ë°˜ë³µí•˜ë©° ì¹´ë©”ë¼ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì˜ˆì¸¡í•˜ëŠ” í•¨ìˆ˜
        function loop() {
            webcam.update(); // ì¹´ë©”ë¼ í™”ë©´ì„ ìƒˆë¡­ê²Œ ì°ì–´ìš”
            predict(); // ì˜ˆì¸¡ì„ í•´ë´ìš”
            window.requestAnimationFrame(loop); // ë‹¤ìŒì—ë„ ë˜ í•´ì¤˜!
        }

        // ğŸ§ ì¸ê³µì§€ëŠ¥ì´ ì˜ˆì¸¡í•˜ê²Œ í•˜ëŠ” í•¨ìˆ˜
        async function predict() {
            // ì¹´ë©”ë¼ í™”ë©´ì„ ì¸ê³µì§€ëŠ¥ì—ê²Œ ë³´ì—¬ì£¼ê³  ì˜ˆì¸¡ ê²°ê³¼ë¥¼ ë°›ì•„ìš”
            const prediction = await model.predict(webcam.canvas);

            // ê²°ê³¼ë¥¼ í•˜ë‚˜ì”© ë³´ì—¬ì¤˜ìš”
            for (let i = 0; i < maxPredictions; i++) {
                // ë°±ë¶„ìœ¨ë¡œ ë§Œë“¤ê³  ì†Œìˆ˜ì ì„ ì—†ì• ìš”
                const percent = (prediction[i].probability * 100).toFixed(0); 
                let emoji = "ğŸ¤”"; // ê¸°ë³¸ ì´ëª¨ì§€ (ì˜ ëª¨ë¥´ê² ì–´)

                // í™•ì‹  ì •ë„ì— ë”°ë¼ ë‹¤ë¥¸ ì´ëª¨ì§€ë¥¼ ë³´ì—¬ì¤˜ìš”
                if (prediction[i].probability > 0.85) {
                    emoji = "ğŸ¯"; // 85% ì´ìƒ: ì•„ì£¼ í™•ì‹¤í•´!
                } else if (prediction[i].probability > 0.60) {
                    emoji = "ğŸ’¡"; // 60% ì´ìƒ: ì•„ë§ˆë„ ì´ê±°ì•¼!
                }

                // ì˜ˆì¸¡ ê²°ê³¼ì™€ ë°±ë¶„ìœ¨ì„ í•©ì³ì„œ ë³´ì—¬ì¤˜ìš”
                const classPrediction = `${emoji} **${prediction[i].className}**: ${percent}%`;

                // ê²°ê³¼ë¥¼ í™”ë©´ì— ë³´ì—¬ì¤˜ìš”
                labelContainer.childNodes[i].innerHTML = classPrediction;
            }
        }
    </script>
</body>
</html>
